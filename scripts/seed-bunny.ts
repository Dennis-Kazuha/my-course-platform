// scripts/seed-bunny.ts
import { db } from '../src/server/db';
import { courses, chapters, lessons, transcripts } from '../src/server/db/schema';
import * as readline from 'readline';

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

const question = (query: string): Promise<string> => {
  return new Promise((resolve) => rl.question(query, resolve));
};

async function main() {
  console.log('ğŸŒ± é–‹å§‹å»ºç«‹ç¨®å­è³‡æ–™...');

  // 1. è¼¸å…¥è³‡æ–™
  const courseTitle = await question('è«‹è¼¸å…¥èª²ç¨‹åç¨± (é è¨­: GenAI Fundamentals): ') || 'GenAI Fundamentals';
  const videoId = await question('è«‹è¼¸å…¥ Bunny Video ID: ');
  const transcriptText = await question('è«‹è²¼ä¸Š TurboScribe é€å­—ç¨¿å…§å®¹ (å–®è¡Œæˆ–ç°¡å–®æ¸¬è©¦ç”¨): ');

  if (!videoId) {
    console.error('âŒ éŒ¯èª¤: å¿…é ˆæä¾› Video ID');
    process.exit(1);
  }

  // 2. å¯«å…¥è³‡æ–™åº«
  console.log('ğŸ“¦ æ­£åœ¨å¯«å…¥è³‡æ–™åº«...');
  
  // å»ºç«‹èª²ç¨‹
  const course = await db.insert(courses).values({
    title: courseTitle,
    description: 'Generated by Seed Script',
  }).returning().get();

  // å»ºç«‹ç« ç¯€
  const chapter = await db.insert(chapters).values({
    courseId: course.id,
    title: 'Chapter 1: Getting Started',
    order: 1,
  }).returning().get();

  // å»ºç«‹å–®å…ƒ
  const lesson = await db.insert(lessons).values({
    chapterId: chapter.id,
    title: 'First Lesson',
    description: 'Deep dive into AI',
    videoId: videoId,
    duration: 120, // å‡è¨­å€¼
    order: 1,
  }).returning().get();

  // å»ºç«‹é€å­—ç¨¿ (é€™è£¡åšä¸€å€‹ç°¡å–®çš„æ¨¡æ“¬åˆ‡å‰²)
  // å¯¦éš› TurboScribe æœƒæœ‰æ™‚é–“æˆ³ï¼Œé€™è£¡æˆ‘å€‘å…ˆå¡ä¸€æ¢æ¸¬è©¦
  await db.insert(transcripts).values({
    lessonId: lesson.id,
    startTime: 0,
    endTime: 10,
    text: transcriptText || 'Welcome to this course.',
    order: 1,
  });

  console.log(`âœ… å®Œæˆï¼èª²ç¨‹ ID: ${course.id}, å–®å…ƒ ID: ${lesson.id}`);
  rl.close();
}

main().catch(console.error);